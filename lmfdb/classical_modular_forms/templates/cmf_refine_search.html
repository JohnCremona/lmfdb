{% extends 'homepage.html' %}

{% block content %}

{% if info.search_type == 'Spaces' %}
{% set weight1options = false %}
{% elif info.search_type == 'Dimensions' %}
{% set weight1options = (info.weight == '1') %}
{% elif info.search_type == 'DynStats' %}
{% set weight1options = true %}
{% else %}
{% set weight1options = 'err' in info or info.all_weight1(info.results) %}
{% endif %}

{% if info.search_type == 'DynStats' %}
<script>
var default_buckets = {};
{% for col, buckets in info.stats._default_buckets %}
default_buckets['{{col}}'] = '{{buckets}}';
{% endfor %}
function set_buckets(col_selecter, bucket_id) {
  if (col_selecter.value in default_buckets) {
    $('#' + bucket_id).val(default_buckets[col_selecter.value]);
  }
}
</script>

<h2>Constraints </h2>
{% else %}
<h2>Refine search </h2>
{% endif %}

<form id="re-search" onsubmit="cleanSubmit(this.id)">
<input type="hidden" name="start" value="{{info.start}}"/>
<input type="hidden" name="count" value="{{info.count}}"/>
<input type="hidden" name="hidden_search_type" value="{{info.search_type}}"/>

<table>
  <tr>
    <td>{{ KNOWL('mf.elliptic.level', title='Level') }}</td>
    <td>{{ KNOWL('mf.elliptic.weight', title='Weight') }}
      <div class="float-right"><select name="weight_parity" class="simult_select" onchange="simult_change(event);">
        <option></option>
        <option value="even"{% if info.weight_parity == 'even' %} selected='yes'{% endif %}>even</option>
        <option value="odd"{% if info.weight_parity == 'odd' %} selected='yes'{% endif %}>odd</option>
      </select></div>
    </td>
    <td>{{ KNOWL('mf.elliptic.dimension', title='Dimension') }}</td>
    <td>{{ KNOWL('mf.elliptic.coefficient_field', title='Coefficient field') }}</td>
    <td>{{ KNOWL('mf.elliptic.analytic_conductor', title='Analytic conductor') }}</td>
  </tr>

  <tr>
    <td><input type='text' style="width: 140px;" name='level'               placeholder='4' value='{{info.level}}'></td>
    <td><input type='text' style="width: 140px;" name='weight'              placeholder='2' value='{{info.weight}}'></td>
    <td><input type='text' style="width: 140px;" name='dim'                 placeholder='1' value='{{info.dim}}'></td>
    <td><input type='text' style="width: 140px;" name='nf_label'            placeholder='1.1.1.1' value='{{info.nf_label}}'></td>
    <td><input type='text' style="width: 140px;" name='analytic_conductor'  placeholder='40-100' value='{{info.analytic_conductor}}'></td>
  </tr>

  <tr>
    <td>{{ KNOWL('mf.elliptic.bad_prime',title='Bad \(p\)') }}
      <div class="float-right"><select name='prime_quantifier'>
          <option value='subsets'{% if info.prime_quantifier == 'subsets' %} selected='yes'{% endif %}>subset of</option>
          <option value=''{% if info.prime_quantifier == 'exact' %} selected='yes'{% endif %}>equal to</option>
          <option value='append'{% if info.prime_quantifier == 'append' %} selected='yes'{% endif %}>superset of</option>
        </select></div>
    </td>
    <td>{{ KNOWL('mf.elliptic.character', title='Character') }}
      <div class="float-right"><select name="weight_parity" class="simult_select" onchange="simult_change(event);">
          <option></option>
          <option value="even"{% if info.char_parity == 'even' %} selected='yes'{% endif %}>even</option>
          <option value="odd"{% if info.char_parity == 'odd' %} selected='yes'{% endif %}>odd</option>
        </select></div>
    </td>
    <td>{{ KNOWL('character.dirichlet.primitive', title='Primitive character') }}</td>
    <td>{{ KNOWL('character.dirichlet.order', title='Character order') }}</td>
    <td>{{ KNOWL('mf.elliptic.analytic_conductor', title='\(Nk^2\)') }}</td>
  </tr>

  <tr>
    <td><input type='text' style="width: 140px;" name='level_primes'  placeholder='2,3'  value="{{info.level_primes}}"></td>
    <td><input type='text' style="width: 140px;" name='char_label'    placeholder='20.d' value='{{info.char_label}}'></td>
    <td><input type='text' style="width: 140px;" name='prim_label'    placeholder='1.a' value='{{info.prim_label}}'></td>
    <td><input type='text' style="width: 140px;" name='char_order'    placeholder='1' value='{{info.char_order}}'></td>
    <td><input type='text' style="width: 140px;" name='Nk2'                 placeholder='40-100' value='{{info.Nk2}}'></td>
  </tr>

  <tr>
    <td>{{ KNOWL('mf.elliptic.self_twist', title='Has self-twist') }}</td>
    <td>{{ KNOWL('mf.elliptic.self_twist', title='CM/RM discriminant')}}</td>
    <td>{{ KNOWL('mf.elliptic.inner_twist_multiplicity', title='Inner twist count') }}</td>
    <td>{{ KNOWL('mf.elliptic.selfdual', title='Is self-dual?') }}</td>
    <td>{{ KNOWL('mf.elliptic.analytic_rank', title='Analytic rank') }}</td>
  </tr>

  <tr>
    <td>
      <select name='has_self_twist' style="width: 150px;">
        {% set self_twist_values = [('', 'unrestricted'), ('yes', 'has self-twist'), ('cm', 'has CM'), ('rm', 'has RM'), ('cm_and_rm', 'has CM and RM'), ('no', 'no self-twists') ] %}
        {% for val, text in self_twist_values %}
        <option value="{{ val }}"{% if info.has_self_twist == val %} selected='yes'{% endif %}>{{ text }}</option>
        {% endfor %}
      </select>
    </td>
    <td><input type='text' style="width: 140px;" name='self_twist_discs' placeholder='-3' value='{{info.self_twist_discs}}'></td>
    <td>
      <input type='text' style="width: 140px;" name='inner_twist_count' placeholder='1-' value='{{info.inner_twist_count}}'>
    </td>
    <td>
      <select name='is_self_dual' style="width: 150px;">
        {% set is_self_dual_values = [('', 'unrestricted'), ('yes', 'yes'), ('no', 'no') ] %}
        {% for val, text in is_self_dual_values %}
        <option value="{{ val }}"{% if info.is_self_dual == val %} selected='yes'{% endif %}>{{ text }}</option>
        {% endfor %}
      </select>
    </td>
    <td><input type='text' style="width: 140px;" name='analytic_rank' placeholder='1' value='{{info.analytic_rank}}'></td>
  </tr>
  <tr>
  </tr>
  {% if weight1options %}
  <tr>
    <td rowspan="2">
      Only for weight 1:
    </td>
    <td>{{ KNOWL('mf.elliptic.projective_image', title='Projective image')}}</td>
    <td>{{ KNOWL('mf.elliptic.projective_image', title='Projective image type') }}</td>
    <td>{{ KNOWL('mf.elliptic.artin_image', title='Artin image size') }}</td>
  </tr>
  <tr>
    <td><input type='text' style="width: 140px" name='projective_image' placeholder='D15' value='{{info.projective_image}}'></td>
    <td>
      <select name='projective_image_type' style="width: 150px;">
        {% set projective_image_type_values = [('', 'unrestricted'), ('Dn', 'Dn'), ('A4', 'A4'), ('S4', 'S4'), ('A5','A5')] %}
        {% for val, text in projective_image_type_values %}
        <option value="{{ val }}"{% if info.projective_image_type == val %} selected='yes'{% endif %}>{{ text }}</option>
        {% endfor %}
      </select>
    </td>
    <td><input type='text' style="width: 140px" name='artin_degree' placeholder='4' value='{{info.artin_degree}}'></td>
  </tr>
  {% endif %}
  <tr>
  </tr>
  {% if info.search_type == 'DynStats' %}
  {% include 'dynamic_stats_input.html' %}
  {% else %}
  <tr style="height:50px">
    <td class="button"><button type='submit' name='search_type' value='{{info.search_type}}' style="width: 110px" onclick='resetStart()'>Search again</button></td>
    {% set search_types = [('List', 'List'), ('Dimensions', 'Dimension Table'), ('Traces', 'Traces Table'), ('Random', 'Random')] %}
    {% for type, desc in search_types %}
    {% if info.search_type != type %}
    <td class="button"><button type='submit' name='search_type' value='{{ type }}'>{{ desc }}</button> &nbsp; &nbsp; </td>
    {% endif %}
    {% endfor %}
  </tr>
  {% endif %}
</table>
{% if info.search_type == 'Traces' %}
<br>
<table>
  <tr>
    <td colspan="2"> Columns to display </td>
    <td> Show </td>
    <td colspan="2"> Trace constraints </td>
    <tr>
      <td>
        <input type='text' style="width: 140px;" name='n' placeholder='1-20' value='{{info.n}}'>
      </td>
      <td style="width: 150px;">
        <span class="formexample"> e.g. 3,7,19, 40-90 </span>
      </td>
      <td>
        <select name='n_primality' style="width: 150px;">
          <option value="all" {{ "selected" if info.n_primality == 'all'}}>all</option>
          <option value="prime_powers" {{ "selected" if info.n_primality == 'prime_powers'}}>prime powers</option>
          <option value="primes" {{ "selected" if info.n_primality == 'primes'}}>primes only</option>
        </select>
      </td>
      <td>
        <input type='text' style="width: 140px;" name='an_constraints' placeholder='a3=2,a5=0' value='{{info.an_constraints}}'>
      </td>
      <td style="width: 150px;">
        <span class="formexample"> e.g. a17=1, a8=0 </span>
      </td>
    </tr>
</table>
{% endif %}
</form>

{% block show_results %}{% endblock %}
{% include 'debug_info.html' %}

{% endblock %}
